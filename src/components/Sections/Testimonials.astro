---
//TESTIMONIALS
import SectionLayout from "@/layouts/SectionLayout.astro";

const logo01Heading = "We partner with";
const logo01Para = "London Venue & catering Awards";
const logo02Heading = "Accredited by the";
const logo02Para = "Meetings Industry Association";

// ----- testimonials data -----
const testimonials = [
    {
        quote: "I have worked with Moneypennies for many years and they have supported us greatly. Their databases are always on point and they will happily work on projects to fill our needs months in advance. Quality of data has always been great and contacts all correct.",
        name: "Antoine Vinial",
        title: "Company",
    },
    {
        quote: "Moneypennies is absolutely fantastic. They have gone above and beyond to help me out. I would completely recommend their services!",
        name: "Client Name",
        title: "Company",
    },
    {
        quote: "Amazing, thank you Wonderwoman!",
        name: "Mellini Gordon",
        title: "Friends House",
    },
];
---

<SectionLayout className="testimonial--section ">
    <!-- <section
        class="md:px-12 py-20 border-t-[0.5px] border-mp-blue"
        aria-labelledby="testimonials-heading"
    > -->

    <section class="testimonial--border" aria-labelledby="testimonials-heading">
        <section class="container--logos">
            <figure class="grid--logos">
                <article id="logo01Text">
                    <h2 class="md__font">{logo01Heading}</h2>
                    <p class="sm__font">{logo01Para}</p>
                </article>

                <img
                    src="/images/logos/London-Venue-2024.png"
                    alt="logo-proud-partner-of-london-venue-catering-awards-2024"
                    id="logo01"
                />

                <img
                    src="/images/logos/Mia-accredited.png"
                    alt="logo-mia-accredited-supplier"
                    id="logo02"
                />
                <article id="logo02Text">
                    <h2 class="md__font">{logo02Heading}</h2>
                    <p class="sm__font">{logo02Para}</p>
                </article>
            </figure>
        </section>

        <!-- <section class="max-w-6xl mx-auto px-10"> -->
        <section class="container--slider max-w-6xl">
            <div class="flex items-center justify-center flex-col gap 2">
                <!----- Testimonial L/R buttons ----->
                <nav
                    aria-label="Testimonial navigation"
                    class="flex gap-4 sm__font items-center pb-10"
                >
                    <!----- L button ----->
                    <button
                        id="prevBtn"
                        class="testimonial-nav-btn opacity-50 hover:opacity-100 transition-opacity duration-300"
                        aria-label="Previous testimonial"
                        type="button"
                    >
                        <svg
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            aria-hidden="true"
                        >
                            <path d="M15 18l-6-6 6-6"></path>
                        </svg>
                    </button>

                    <!----- R button ----->
                    <button
                        id="nextBtn"
                        class="testimonial-nav-btn opacity-50 hover:opacity-100 transition-opacity duration-300"
                        aria-label="Next testimonial"
                        type="button"
                    >
                        <svg
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            aria-hidden="true"
                        >
                            <path d="M9 18l6-6-6-6"></path>
                        </svg>
                    </button>
                </nav>
                <header class="mb-10">
                    <h2 id="testimonials-heading" class="lg__font">
                        TESTIMONIALS
                    </h2>
                </header>
            </div>
            <section
                class="testimonial-container relative overflow-hidden"
                role="region"
                aria-live="polite"
                aria-label="Client testimonials"
            >
                {
                    testimonials.map((testimonial, index) => (
                        <article
                            class={`testimonial-slide absolute inset-0 transition-opacity duration-300 ease-in-out ${index === 0 ? "opacity-100" : "opacity-0"}`}
                            data-index={index}
                            aria-hidden={index !== 0 ? "true" : "false"}
                        >
                            <article class="text-center max-w-4xl mx-auto px-4 sm__font">
                                <blockquote class=" sm__font font-light  mb-12 ">
                                    <p>"{testimonial.quote}"</p>
                                </blockquote>
                                <aside class="space-y-2">
                                    <cite class="sm__font   not-italic">
                                        {testimonial.name}
                                    </cite>
                                    <p class="sm__font text-gray-400 ">
                                        {testimonial.title}
                                    </p>
                                </aside>
                            </article>
                        </article>
                    ))
                }
            </section>
        </section>
    </section>

    <!-- Accreditation/partner logos -->
</SectionLayout>
<style lang="scss">
    .container--slider,
    .tesimonials-heading {
        padding: 4rem 4rem 0 4rem;
        // margin-left: auto;
        // margin-right: auto;
    }

    .container--logos {
        // padding: 0rem 2rem 4rem 2rem;
        // display: flex;
        // justify-content: center;
        // align-items: center;
    }
    #logo01Text {
        grid-area: logo01Text;
    }
    #logo01 {
        grid-area: logo01;
    }

    #logo02Text {
        grid-area: logo02Text;
    }

    #logo02 {
        grid-area: logo02;
    }

    .grid--logos {
        display: grid;
        height: 100%;
        grid-template-columns: 20rem;
        grid-gap: 10px 10px;

        grid-template-areas:
            "logo01Text ."
            "logo01 ."
            ".logo02"
            ". logo02Text";

        // display: grid;

        // justify-content: center;
        // align-items: center;
        // gap: 4rem;

        // @include for-size(tablet, up) {
        //     gap: 4rem;
        // }
    }

    // #logo01Text {
    //     grid-column: 1 / 2;
    //     // grid-column-start: 1;
    //     // grid-column-end: 2;
    // }

    // #logo01 {
    //     grid-column: 2 / 3;
    // }

    #logo01,
    #logo02 {
        max-height: 10vh;
        width: auto;
        align-self: center;
        @include for-size(tablet, up) {
            max-height: 20vh;
            width: auto;
        }
    }

    //DON'T NEED THIS
    .testimonial--border {
        // background: #f6f0e7;
        // color: #22219b !important;
        // border-top: 0.5px solid #22219b;
        padding-top: 4rem;
    }

    // THIS ONE
    // .testimonial--border {
    //     // background: #f6f0e7;
    //     // color: #22219b !important;
    //     position: relative;
    //     padding-top: 4rem;

    //     &::before {
    //         content: "";
    //         position: absolute;
    //         top: 0;
    //         left: 2rem;
    //         right: 2rem;
    //         height: 2px;
    //         // box-shadow: 4px 2px 6px 1px;
    //         background-color: #22219b;
    //     }
    // }

    .testimonial-nav-btn {
        @apply p-2 rounded-full hover:border-mp-blue transition-all duration-300;
    }

    .testimonial-nav-btn:hover {
        background-color: #22219b;
    }

    .testimonial-container {
        min-height: 40vh;
        position: relative;
    }
</style>

<script>
    class TestimonialSlider {
        currentIndex: number;
        testimonials: NodeListOf<Element>;
        totalTestimonials: number;
        prevBtn: HTMLElement | null;
        nextBtn: HTMLElement | null;
        constructor() {
            this.currentIndex = 0;
            this.testimonials = document.querySelectorAll(".testimonial-slide");
            this.totalTestimonials = this.testimonials.length;
            this.prevBtn = document.getElementById("prevBtn");
            this.nextBtn = document.getElementById("nextBtn");

            this.init();
        }

        init() {
            this.updateButtons();
            this.bindEvents();
        }

        bindEvents() {
            this.nextBtn?.addEventListener("click", () => this.next());
            this.prevBtn?.addEventListener("click", () => this.prev());

            // Optional: Auto-advance every 8 seconds
            setInterval(() => this.next(), 8000);

            // Keyboard navigation
            document.addEventListener("keydown", (e) => {
                if (e.key === "ArrowLeft") this.prev();
                if (e.key === "ArrowRight") this.next();
            });
        }

        next() {
            this.currentIndex =
                (this.currentIndex + 1) % this.totalTestimonials;
            this.updateSlider();
        }

        prev() {
            this.currentIndex =
                this.currentIndex === 0
                    ? this.totalTestimonials - 1
                    : this.currentIndex - 1;
            this.updateSlider();
        }

        updateSlider() {
            // Hide all testimonials
            this.testimonials.forEach((testimonial, index) => {
                if (index === this.currentIndex) {
                    testimonial.classList.remove("opacity-0");
                    testimonial.classList.add("opacity-100");
                    testimonial.setAttribute("aria-hidden", "false");
                } else {
                    testimonial.classList.remove("opacity-100");
                    testimonial.classList.add("opacity-0");
                    testimonial.setAttribute("aria-hidden", "true");
                }
            });

            this.updateButtons();
        }

        updateButtons() {
            // Update button opacity based on position (optional)
            if (this.prevBtn && this.nextBtn) {
                this.prevBtn.style.opacity =
                    this.currentIndex === 0 ? "0.3" : "0.5";
                this.nextBtn.style.opacity =
                    this.currentIndex === this.totalTestimonials - 1
                        ? "0.3"
                        : "0.5";
            }
        }
    }

    // Initialize when DOM is loaded
    document.addEventListener("DOMContentLoaded", () => {
        new TestimonialSlider();
    });
</script>
